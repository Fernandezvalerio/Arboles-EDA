<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simulador Mejorado de Splay Tree</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f0f0f0;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 1200px;
      margin: auto;
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h1, h2 {
      text-align: center;
      color: #333;
    }
    .controls, .explanation {
      margin-bottom: 20px;
    }
    input {
      padding: 10px;
      font-size: 16px;
      width: calc(100% - 22px);
      margin-bottom: 10px;
    }
    button {
      padding: 10px;
      font-size: 16px;
      margin: 5px;
      cursor: pointer;
    }
    svg {
      width: 100%;
      height: 500px;
      border: 1px solid #ccc;
      background-color: #fff;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Simulador Mejorado de Splay Tree</h1>
    <div class="controls">
      <input type="number" id="inputValor" placeholder="Ingrese un valor" />
      <div>
        <button onclick="insertar()">Insertar</button>
        <button onclick="buscar()">Buscar</button>
        <button onclick="eliminar()">Eliminar</button>
        <button onclick="reiniciar()">Reiniciar</button>
      </div>
    </div>
    <svg id="canvas"></svg>
    <div class="explanation">
      <h2>Explicación</h2>
      <p id="explicacion">Ingrese un valor y seleccione una operación.</p>
    </div>
  </div>

  <script>
    class Nodo {
      constructor(valor) {
        this.valor = valor;
        this.izq = null;
        this.der = null;
        this.padre = null;
        this.x = 0;
        this.y = 0;
      }
    }

    class SplayTree {
      constructor() {
        this.raiz = null;
      }

      rotacionIzquierda(x) {
        const y = x.der;
        x.der = y.izq;
        if (y.izq) y.izq.padre = x;
        y.padre = x.padre;
        if (!x.padre) this.raiz = y;
        else if (x.padre.izq === x) x.padre.izq = y;
        else x.padre.der = y;
        y.izq = x;
        x.padre = y;
      }

      rotacionDerecha(x) {
        const y = x.izq;
        x.izq = y.der;
        if (y.der) y.der.padre = x;
        y.padre = x.padre;
        if (!x.padre) this.raiz = y;
        else if (x.padre.izq === x) x.padre.izq = y;
        else x.padre.der = y;
        y.der = x;
        x.padre = y;
      }

      splay(x) {
        while (x.padre) {
          if (!x.padre.padre) {
            if (x.padre.izq === x) this.rotacionDerecha(x.padre);
            else this.rotacionIzquierda(x.padre);
          } else if (x.padre.izq === x && x.padre.padre.izq === x.padre) {
            this.rotacionDerecha(x.padre.padre);
            this.rotacionDerecha(x.padre);
          } else if (x.padre.der === x && x.padre.padre.der === x.padre) {
            this.rotacionIzquierda(x.padre.padre);
            this.rotacionIzquierda(x.padre);
          } else if (x.padre.der === x && x.padre.padre.izq === x.padre) {
            this.rotacionIzquierda(x.padre);
            this.rotacionDerecha(x.padre);
          } else {
            this.rotacionDerecha(x.padre);
            this.rotacionIzquierda(x.padre);
          }
        }
      }

      insertar(valor) {
        let z = this.raiz;
        let p = null;
        while (z) {
          p = z;
          if (valor < z.valor) z = z.izq;
          else if (valor > z.valor) z = z.der;
          else {
            this.splay(z);
            mostrarExplicacion(`Valor ${valor} ya existe. Se ha hecho splay.`);
            return;
          }
        }
        z = new Nodo(valor);
        z.padre = p;
        if (!p) this.raiz = z;
        else if (valor < p.valor) p.izq = z;
        else p.der = z;
        this.splay(z);
        mostrarExplicacion(`Insertado ${valor} y realizado splay.`);
      }

      buscar(valor) {
        let z = this.raiz;
        while (z) {
          if (valor < z.valor) z = z.izq;
          else if (valor > z.valor) z = z.der;
          else {
            this.splay(z);
            mostrarExplicacion(`Valor ${valor} encontrado. Se hizo splay.`);
            return;
          }
        }
        mostrarExplicacion(`Valor ${valor} no encontrado.`);
      }

      eliminar(valor) {
        this.buscar(valor);
        if (!this.raiz || this.raiz.valor !== valor) {
          mostrarExplicacion(`Valor ${valor} no encontrado para eliminar.`);
          return;
        }
        if (!this.raiz.izq) {
          this.raiz = this.raiz.der;
          if (this.raiz) this.raiz.padre = null;
        } else if (!this.raiz.der) {
          this.raiz = this.raiz.izq;
          if (this.raiz) this.raiz.padre = null;
        } else {
          let x = this.raiz.der;
          while (x.izq) x = x.izq;
          if (x.padre !== this.raiz) {
            x.padre.izq = x.der;
            if (x.der) x.der.padre = x.padre;
            x.der = this.raiz.der;
            x.der.padre = x;
          }
          x.izq = this.raiz.izq;
          x.izq.padre = x;
          this.raiz = x;
          x.padre = null;
        }
        mostrarExplicacion(`Valor ${valor} eliminado.`);
      }

      dibujar(svg) {
        svg.innerHTML = "";
        if (!this.raiz) return;
        this.posicionar(this.raiz, svg.clientWidth / 2, 40, svg.clientWidth / 4);
        this.dibujarRec(svg, this.raiz);
      }

      posicionar(nodo, x, y, sep) {
        if (!nodo) return;
        nodo.x = x;
        nodo.y = y;
        this.posicionar(nodo.izq, x - sep, y + 70, sep / 2);
        this.posicionar(nodo.der, x + sep, y + 70, sep / 2);
      }

      dibujarRec(svg, nodo) {
        if (!nodo) return;
        if (nodo.izq) {
          this.dibujarLinea(svg, nodo, nodo.izq);
          this.dibujarRec(svg, nodo.izq);
        }
        if (nodo.der) {
          this.dibujarLinea(svg, nodo, nodo.der);
          this.dibujarRec(svg, nodo.der);
        }
        this.dibujarNodo(svg, nodo);
      }

      dibujarNodo(svg, nodo) {
        const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        circle.setAttribute("cx", nodo.x);
        circle.setAttribute("cy", nodo.y);
        circle.setAttribute("r", 20);
        circle.setAttribute("fill", "#3498db");
        circle.setAttribute("stroke", "#000");
        svg.appendChild(circle);

        const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
        text.setAttribute("x", nodo.x);
        text.setAttribute("y", nodo.y + 5);
        text.setAttribute("text-anchor", "middle");
        text.setAttribute("fill", "#fff");
        text.setAttribute("font-weight", "bold");
        text.textContent = nodo.valor;
        svg.appendChild(text);
      }

      dibujarLinea(svg, desde, hacia) {
        const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
        line.setAttribute("x1", desde.x);
        line.setAttribute("y1", desde.y);
        line.setAttribute("x2", hacia.x);
        line.setAttribute("y2", hacia.y);
        line.setAttribute("stroke", "#999");
        svg.appendChild(line);
      }
    }

    const arbol = new SplayTree();
    const svg = document.getElementById("canvas");

    function insertar() {
      const val = parseInt(document.getElementById("inputValor").value);
      if (!isNaN(val)) {
        arbol.insertar(val);
        arbol.dibujar(svg);
      }
    }

    function buscar() {
      const val = parseInt(document.getElementById("inputValor").value);
      if (!isNaN(val)) {
        arbol.buscar(val);
        arbol.dibujar(svg);
      }
    }

    function eliminar() {
      const val = parseInt(document.getElementById("inputValor").value);
      if (!isNaN(val)) {
        arbol.eliminar(val);
        arbol.dibujar(svg);
      }
    }

    function reiniciar() {
      arbol.raiz = null;
      svg.innerHTML = "";
      mostrarExplicacion("Arbol reiniciado.");
    }

    function mostrarExplicacion(msg) {
      document.getElementById("explicacion").textContent = msg;
    }
  </script>
</body>
</html>
